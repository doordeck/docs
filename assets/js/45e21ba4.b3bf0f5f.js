"use strict";(self.webpackChunkdoordeck_docs=self.webpackChunkdoordeck_docs||[]).push([[6797],{825:(e,t,r)=>{r.d(t,{A:()=>n});const n='# If you don\'t have an ephemeral key yet, generate one, otherwise reuse the existing one\nopenssl genpkey -algorithm ed25519 -out private.der\n\n# Format the public key for use with the ephemeral key registration endpoint\nPUBLIC_KEY=`openssl pkey -in private.key -pubout -outform DER -out - | base64`\n\n# Register the keypair with Doordeck (may require verification, see "Register Ephemeral Key With Secondary Authentication")\nAPI_RESPONSE=$(curl -s -X POST https://api.doordeck.com/auth/certificate \\\n  -H \'authorization: Bearer TOKEN\' \\\n  -H \'content-type: application/json\' \\\n  -d \'{"ephemeralKey":"\'$PUBLIC_KEY\'"}\')\n\n# Setup variables needed for the unlock operation\nCERTIFICATE_CHAIN=$(echo $API_RESPONSE | jq -r .certificateChain)\nUSER_ID=$(echo $API_RESPONSE | jq -r .userId)\nDEVICE_ID="00000000-0000-0000-0000-000000000000" # Replace with the lock\'s ID\n\nHEADER=$(jq -n \\\n  --arg alg "EdDSA" \\\n  --arg typ "JWT" \\\n  --argjson x5c "$CERTIFICATE_CHAIN" \\\n  \'{\n    alg: $alg,\n    typ: $typ,\n    x5c: $x5c\n  }\')\n'},2619:(e,t,r)=>{r.d(t,{A:()=>n});const n="# Prepare and sign the JWT\nHEADER_B64=`echo -n $HEADER | base64 | sed 's/+/-/g;s/\\//_/g;s/=//g'`\nBODY_B64=`echo -n $BODY | base64  | sed 's/+/-/g;s/\\//_/g;s/=//g'`\necho -n $HEADER_B64.$BODY_B64 > tbs.bin\nSIGNATURE_B64=$(openssl pkeyutl -sign -inkey private.key -rawin -in tbs.bin | base64 | sed 's/+/-/g;s/\\//_/g;s/=//g')\nJWT=$HEADER_B64.$BODY_B64.$SIGNATURE_B64\n\ncurl \"https://api.doordeck.com/device/$DEVICE_ID/execute\"\n  -X POST\n  -H 'authorization: Bearer TOKEN'\n  -H 'content-type: application/jwt'\n  --data-binary \"$JWT\"\n"},5537:(e,t,r)=>{r.d(t,{A:()=>E});var n=r(6540),s=r(4164),i=r(5627),a=r(6347),l=r(372),c=r(604),o=r(1861),d=r(8749);function h(e){return n.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,n.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function u(e){const{values:t,children:r}=e;return(0,n.useMemo)((()=>{const e=t??function(e){return h(e).map((({props:{value:e,label:t,attributes:r,default:n}})=>({value:e,label:t,attributes:r,default:n})))}(r);return function(e){const t=(0,o.XI)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,r])}function p({value:e,tabValues:t}){return t.some((t=>t.value===e))}function x({queryString:e=!1,groupId:t}){const r=(0,a.W6)(),s=function({queryString:e=!1,groupId:t}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:e,groupId:t});return[(0,c.aZ)(s),(0,n.useCallback)((e=>{if(!s)return;const t=new URLSearchParams(r.location.search);t.set(s,e),r.replace({...r.location,search:t.toString()})}),[s,r])]}function j(e){const{defaultValue:t,queryString:r=!1,groupId:s}=e,i=u(e),[a,c]=(0,n.useState)((()=>function({defaultValue:e,tabValues:t}){if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!p({value:e,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const r=t.find((e=>e.default))??t[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:t,tabValues:i}))),[o,h]=x({queryString:r,groupId:s}),[j,b]=function({groupId:e}){const t=function(e){return e?`docusaurus.tab.${e}`:null}(e),[r,s]=(0,d.Dv)(t);return[r,(0,n.useCallback)((e=>{t&&s.set(e)}),[t,s])]}({groupId:s}),f=(()=>{const e=o??j;return p({value:e,tabValues:i})?e:null})();(0,l.A)((()=>{f&&c(f)}),[f]);return{selectedValue:a,selectValue:(0,n.useCallback)((e=>{if(!p({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);c(e),h(e),b(e)}),[h,b,i]),tabValues:i}}var b=r(9136);const f={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var m=r(4848);function g({className:e,block:t,selectedValue:r,selectValue:n,tabValues:a}){const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,i.a_)(),o=e=>{const t=e.currentTarget,s=l.indexOf(t),i=a[s].value;i!==r&&(c(t),n(i))},d=e=>{let t=null;switch(e.key){case"Enter":o(e);break;case"ArrowRight":{const r=l.indexOf(e.currentTarget)+1;t=l[r]??l[0];break}case"ArrowLeft":{const r=l.indexOf(e.currentTarget)-1;t=l[r]??l[l.length-1];break}}t?.focus()};return(0,m.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,s.A)("tabs",{"tabs--block":t},e),children:a.map((({value:e,label:t,attributes:n})=>(0,m.jsx)("li",{role:"tab",tabIndex:r===e?0:-1,"aria-selected":r===e,ref:e=>{l.push(e)},onKeyDown:d,onClick:o,...n,className:(0,s.A)("tabs__item",f.tabItem,n?.className,{"tabs__item--active":r===e}),children:t??e},e)))})}function v({lazy:e,children:t,selectedValue:r}){const i=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){const e=i.find((e=>e.props.value===r));return e?(0,n.cloneElement)(e,{className:(0,s.A)("margin-top--md",e.props.className)}):null}return(0,m.jsx)("div",{className:"margin-top--md",children:i.map(((e,t)=>(0,n.cloneElement)(e,{key:t,hidden:e.props.value!==r})))})}function y(e){const t=j(e);return(0,m.jsxs)("div",{className:(0,s.A)("tabs-container",f.tabList),children:[(0,m.jsx)(g,{...t,...e}),(0,m.jsx)(v,{...t,...e})]})}function E(e){const t=(0,b.A)();return(0,m.jsx)(y,{...e,children:h(e.children)},String(t))}},7748:(e,t,r)=>{r.d(t,{Ay:()=>l,RM:()=>i});var n=r(4848),s=r(8453);const i=[];function a(e){const t={code:"code",p:"p",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,s.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(t.p,{children:"The JWT header is formed of the following fields:"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Parameter"}),(0,n.jsx)(t.th,{children:"Required"}),(0,n.jsx)(t.th,{children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"alg"}),(0,n.jsx)(t.td,{children:"true"}),(0,n.jsxs)(t.td,{children:[(0,n.jsx)(t.code,{children:"EdDSA"})," EdDSA for ephemeral key signatures"]})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"x5c"}),(0,n.jsx)(t.td,{children:"true"}),(0,n.jsx)(t.td,{children:"User's certificate chain"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"typ"}),(0,n.jsx)(t.td,{children:"true"}),(0,n.jsxs)(t.td,{children:[(0,n.jsx)(t.code,{children:"JWT"}),", JSON Web Token"]})]})]})]}),"\n",(0,n.jsx)(t.p,{children:"The JWT body is formed of the following fields:"}),"\n",(0,n.jsxs)(t.table,{children:[(0,n.jsx)(t.thead,{children:(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.th,{children:"Parameter"}),(0,n.jsx)(t.th,{children:"Required"}),(0,n.jsx)(t.th,{children:"Description"})]})}),(0,n.jsxs)(t.tbody,{children:[(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"iss"}),(0,n.jsx)(t.td,{children:"true"}),(0,n.jsx)(t.td,{children:"Issuer, this should be the user's ID"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"sub"}),(0,n.jsx)(t.td,{children:"true"}),(0,n.jsx)(t.td,{children:"Subject, this should be the lock's ID"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"nbf"}),(0,n.jsx)(t.td,{children:"true"}),(0,n.jsx)(t.td,{children:"Not before, a Unix timestamp indicating the earliest date the request is valid from, set to the current time"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"iat"}),(0,n.jsx)(t.td,{children:"true"}),(0,n.jsx)(t.td,{children:"Issued at, the current Unix timestamp"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"exp"}),(0,n.jsx)(t.td,{children:"true"}),(0,n.jsx)(t.td,{children:"Expires, a Unix timestamp indicating when the request should expire, typically now plus 60 seconds"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"jti"}),(0,n.jsx)(t.td,{children:"false (highly recommended)"}),(0,n.jsx)(t.td,{children:"User generated, unique ID used for tracking the request status and preventing replay attacks. UUIDs are recommended here"})]}),(0,n.jsxs)(t.tr,{children:[(0,n.jsx)(t.td,{children:"operation"}),(0,n.jsx)(t.td,{children:"true"}),(0,n.jsx)(t.td,{children:"A JSON object containing the operation to perform, see below"})]})]})]})]})}function l(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,n.jsx)(t,{...e,children:(0,n.jsx)(a,{...e})}):a(e)}},8016:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>x,contentTitle:()=>p,default:()=>f,frontMatter:()=>u,metadata:()=>n,toc:()=>j});const n=JSON.parse('{"id":"cloud-api/lock-operations/batch-share-a-lock-v2","title":"Batch Share A Lock (v2)","description":"Not all devices support this operation, check for the presence of the BATCHSHARING25 capability.","source":"@site/docs/cloud-api/lock-operations/batch-share-a-lock-v2.md","sourceDirName":"cloud-api/lock-operations","slug":"/cloud-api/lock-operations/batch-share-a-lock-v2","permalink":"/cloud-api/lock-operations/batch-share-a-lock-v2","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":14,"frontMatter":{"sidebar_position":14},"sidebar":"tutorialSidebar","previous":{"title":"Share A Lock (v1)","permalink":"/cloud-api/lock-operations/share-a-lock-v1"},"next":{"title":"Revoke Access To A Lock","permalink":"/cloud-api/lock-operations/revoke-access-to-a-lock"}}');var s=r(4848),i=r(8453),a=r(7748),l=r(5537),c=r(9329),o=r(8069),d=r(825),h=r(2619);const u={sidebar_position:14},p="Batch Share A Lock (v2)",x={},j=[{value:"HTTP Request",id:"http-request",level:3},{value:"Request Parameters",id:"request-parameters",level:3},...a.RM,{value:"Example",id:"example",level:3}];function b(e){const t={admonition:"admonition",code:"code",h1:"h1",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.header,{children:(0,s.jsx)(t.h1,{id:"batch-share-a-lock-v2",children:"Batch Share A Lock (v2)"})}),"\n",(0,s.jsx)(t.admonition,{type:"info",children:(0,s.jsxs)(t.p,{children:["Not all devices support this operation, check for the presence of the ",(0,s.jsx)(t.code,{children:"BATCH_SHARING_25"})," capability."]})}),"\n",(0,s.jsx)(t.p,{children:"Share a single lock with up to 25 users in a single request."}),"\n",(0,s.jsx)(t.h3,{id:"http-request",children:"HTTP Request"}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.code,{children:"POST https://api.doordeck.com/device/LOCK_ID/execute"})}),"\n",(0,s.jsx)(t.admonition,{title:"Success",type:"tip",children:(0,s.jsx)(t.p,{children:"If a request expires within the next 60 seconds, a 204 is returned upon success, if a request expires in more than 60 seconds, a 202 is returned to indicate the request has been queued for the device."})}),"\n",(0,s.jsx)(t.h3,{id:"request-parameters",children:"Request Parameters"}),"\n","\n",(0,s.jsx)(a.Ay,{name:"Secure operation parameters"}),"\n",(0,s.jsx)(t.p,{children:"The operation object definition is as follows"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Parameter"}),(0,s.jsx)(t.th,{children:"Required"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"type"}),(0,s.jsx)(t.td,{children:"true"}),(0,s.jsxs)(t.td,{children:["Must be ",(0,s.jsx)(t.code,{children:"BATCH_ADD_USER"})]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"users"}),(0,s.jsx)(t.td,{children:"true"}),(0,s.jsx)(t.td,{children:"List of user objects"})]})]})]}),"\n",(0,s.jsx)(t.p,{children:"The user object definition is as follows"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Parameter"}),(0,s.jsx)(t.th,{children:"Required"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"user"}),(0,s.jsx)(t.td,{children:"true"}),(0,s.jsx)(t.td,{children:"ID of user to add"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"publicKey"}),(0,s.jsx)(t.td,{children:"true"}),(0,s.jsx)(t.td,{children:"Public key of user to add"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"role"}),(0,s.jsx)(t.td,{children:"false"}),(0,s.jsx)(t.td,{children:"Should be either ADMIN or USER"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"start"}),(0,s.jsx)(t.td,{children:"false"}),(0,s.jsx)(t.td,{children:"Unix timestamp of when the user should be active from, null or unset to start immediately"})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"end"}),(0,s.jsx)(t.td,{children:"false"}),(0,s.jsx)(t.td,{children:"Unix timestamp of when the user should expire, null or unset for never expires"})]})]})]}),"\n",(0,s.jsx)(t.p,{children:"After the request has been signed with user's private key, it should be sent to the execute endpoint."}),"\n",(0,s.jsx)(t.h3,{id:"example",children:"Example"}),"\n","\n",(0,s.jsxs)(l.A,{children:[(0,s.jsxs)(c.A,{value:"request",label:"Request",children:[(0,s.jsx)(o.A,{language:"shell",title:"CURL",children:`${d.A}\n\nBODY=$(\njq -n \\\n  --arg iss "$USER_ID" \\\n  --arg sub "$DEVICE_ID" \\\n  --arg jti "$(uuidgen)" \\\n  --arg publicKey "INVITEE_PUBLIC_KEY" \\\n  --arg user "11111111-1111-1111-1111-111111111111" \\\n  --arg role "USER" \\\n  --argjson nbf "$(date +%s)" \\\n  --argjson iat "$(date +%s)" \\\n  --argjson exp "$(($(date +%s) + 60))" \\\n  --argjson start "$USER_START_TIME" \\\n  --argjson end "$USER_END_TIME" \\\n  '{\n    iss: $iss,\n    sub: $sub,\n    jti: $jti,\n    nbf: $nbf,\n    iat: $iat,\n    exp: $exp,\n    operation: {\n      type: "BATCH_ADD_USER",\n      users: [\n        {\n          publicKey: $publicKey,\n          user: $user,\n          role: $role,\n          start: $start,\n          end: $end\n        }\n      ]\n    }\n  }'\n)\n\n${h.A}`}),(0,s.jsx)(t.admonition,{title:"Remember",type:"info",children:(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["Replace ",(0,s.jsx)(t.code,{children:"TOKEN"})," with your access token."]}),"\n",(0,s.jsxs)(t.li,{children:["Replace ",(0,s.jsx)(t.code,{children:"00000000-0000-0000-0000-000000000000"})," with the lock's ID."]}),"\n",(0,s.jsxs)(t.li,{children:["Replace ",(0,s.jsx)(t.code,{children:"11111111-1111-1111-1111-111111111111"})," with the invitee's user ID."]}),"\n",(0,s.jsxs)(t.li,{children:["Replace ",(0,s.jsx)(t.code,{children:"INVITEE_PUBLIC_KEY"})," with the invitee's public key (retrieve from the lookup user public key endpoint)."]}),"\n",(0,s.jsxs)(t.li,{children:["Replace ",(0,s.jsx)(t.code,{children:"USER_START_TIME"})," and ",(0,s.jsx)(t.code,{children:"USER_END_TIME"})," with Unix timestamps of when the user should be activated from and until, use null for indefinite."]}),"\n"]})})]}),(0,s.jsx)(c.A,{value:"response",label:"Response",children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-json",metastring:'showLineNumbers title="JSON"',children:"{}\n"})})})]})]})}function f(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(b,{...e})}):b(e)}},9329:(e,t,r)=>{r.d(t,{A:()=>a});r(6540);var n=r(4164);const s={tabItem:"tabItem_Ymn6"};var i=r(4848);function a({children:e,hidden:t,className:r}){return(0,i.jsx)("div",{role:"tabpanel",className:(0,n.A)(s.tabItem,r),hidden:t,children:e})}}}]);